<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    template="/plantilla/plantilla.xhtml">

    <ui:define name="content">

        <h:form id="formOperaciones">
            <p:messages id="messages" showDetail="true" closable="true" />

            <h3>Mantenimiento de Operaciones</h3>
            <p>Gesti√≥n de las operaciones asociadas a entidades y conexiones.</p>

            <h:panelGrid styleClass="checkBoxGrid" columns="6" cellpadding="3">
                <p:outputLabel for="chkIdOperacion" value="Buscar por ID Operaci√≥n" />
                <p:selectBooleanCheckbox id="chkIdOperacion"
                    value="#{operacionController.operacionModel.buscarPorIdOperacion}">
                    <p:ajax listener="#{operacionController.seleccionarBusquedaPorIdOperacion}"
                        update="formOperaciones:panelBusqueda" />
                </p:selectBooleanCheckbox>
                
                <p:outputLabel for="chkIdEntidad" value="Buscar por ID Entidad" />
                <p:selectBooleanCheckbox id="chkIdEntidad"
                    value="#{operacionController.operacionModel.buscarPorIdEntidad}">
                    <p:ajax listener="#{operacionController.seleccionarBusquedaPorIdEntidad}"
                        update="formOperaciones:panelBusqueda" />
                </p:selectBooleanCheckbox>

                <p:outputLabel for="chkCodigoOperacion" value="Buscar por C√≥digo Operaci√≥n" />
                <p:selectBooleanCheckbox id="chkCodigoOperacion"
                    value="#{operacionController.operacionModel.buscarPorCodigoOperacion}">
                    <p:ajax listener="#{operacionController.seleccionarBusquedaPorCodigoOperacion}"
                        update="formOperaciones:panelBusqueda" />
                </p:selectBooleanCheckbox>
            </h:panelGrid>

            <!-- üîç Panel para b√∫squeda por ID de Operaci√≥n, ID de Entidad y/o C√≥digo de Operaci√≥n -->
            <h:panelGroup id="panelBusqueda">
                <h:panelGrid columns="3" cellpadding="5"
                    rendered="#{operacionController.operacionModel.buscarPorIdOperacion or operacionController.operacionModel.buscarPorIdEntidad or operacionController.operacionModel.buscarPorCodigoOperacion}">
                    
                    <p:outputLabel for="buscarIdOperacion" value="ID Operaci√≥n:"
                        rendered="#{operacionController.operacionModel.buscarPorIdOperacion}" />
                    <p:inputText id="buscarIdOperacion"
                        value="#{operacionController.operacionModel.filtroIdOperacion}"
                        converter="javax.faces.Long"
                        rendered="#{operacionController.operacionModel.buscarPorIdOperacion}" />
                    <h:panelGroup rendered="#{operacionController.operacionModel.buscarPorIdOperacion}" /> <!-- Espaciador -->

                    <p:outputLabel for="buscarIdEntidad" value="ID Entidad:"
                        rendered="#{operacionController.operacionModel.buscarPorIdEntidad}" />
                    <p:inputText id="buscarIdEntidad"
                        value="#{operacionController.operacionModel.filtroIdEntidad}"
                        rendered="#{operacionController.operacionModel.buscarPorIdEntidad}" />
                    <h:panelGroup rendered="#{operacionController.operacionModel.buscarPorIdEntidad}" /> <!-- Espaciador -->

                    <p:outputLabel for="buscarCodigoOperacion" value="C√≥digo Operaci√≥n:"
                        rendered="#{operacionController.operacionModel.buscarPorCodigoOperacion}" />
                    <p:inputText id="buscarCodigoOperacion"
                        value="#{operacionController.operacionModel.filtroCodigoOperacion}"
                        rendered="#{operacionController.operacionModel.buscarPorCodigoOperacion}" />
                    <h:panelGroup rendered="#{operacionController.operacionModel.buscarPorCodigoOperacion}" /> <!-- Espaciador -->

                    <p:commandButton value="Buscar" icon="fa fa-search"
                        actionListener="#{operacionController.buscarOperacionPorId}"
                        update="formOperaciones:tablaOperaciones, formOperaciones:messages"
                        rendered="#{operacionController.operacionModel.buscarPorIdOperacion or operacionController.operacionModel.buscarPorIdEntidad or operacionController.operacionModel.buscarPorCodigoOperacion}" />
                </h:panelGrid>
            </h:panelGroup>

            <!-- ‚öô Botones principales -->
            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Nuevo" icon="fa fa-plus"
                        onclick="PF('dlgOperacion').show();" process="@this"
                        update="formDialogOperacion" />
                        
                    <p:commandButton value="Modificar" icon="fa fa-edit"
                        actionListener="#{operacionController.cargarOperacionSeleccionada}"
                        update="formOperaciones,formDialogOperacion" process="@this"
                        disabled="#{empty operacionController.operacionModel.operacionesSeleccionadas}" />
                </p:toolbarGroup>
            </p:toolbar>

            <!-- üìã Tabla -->
            <p:dataTable id="tablaOperaciones" var="operacion"
                styleClass="tabla-chica"
                value="#{operacionController.operacionModel.listaOperaciones}"
                selection="#{operacionController.operacionModel.operacionesSeleccionadas}"
                rowKey="#{operacion.idOperacion}" rowIndexVar="index" paginator="true" rows="5"
                paginatorPosition="bottom"
                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                rowsPerPageTemplate="5,10,15,20" scrollable="true"
                scrollHeight="250" resizableColumns="true"
                emptyMessage="No se encontraron operaciones" update="@form">
                <p:ajax event="rowSelectCheckbox" process="@this"
                    update=":formOperaciones" />
                <p:ajax event="rowUnselectCheckbox" process="@this"
                    update=":formOperaciones" />
                <p:ajax event="toggleSelect" process="@this" update=":formOperaciones" />
                <p:column selectionMode="multiple"
                    style="width:16px;text-align:center" />

                <!-- üÜî ID Operaci√≥n -->
                <p:column headerText="ID Operaci√≥n">
                    <h:outputText value="#{operacion.idOperacion}" />
                </p:column>

                <!-- üÜî ID Entidad -->
                <p:column headerText="ID Entidad">
                    <h:outputText value="#{operacion.idEntidad}" />
                </p:column>

                <!-- üÜî ID Conexi√≥n -->
                <p:column headerText="ID Conexi√≥n">
                    <h:outputText value="#{operacion.idConexion}" />
                </p:column>

                <!-- üìÑ Descripci√≥n -->
                <p:column headerText="Descripci√≥n">
                    <h:outputText value="#{operacion.descripcion}" />
                </p:column>

                <!-- ‚û°Ô∏è Requiere Body Env√≠o -->
                <p:column headerText="Requiere Body Env√≠o">
                    <h:outputText value="#{operacion.requiereBodyEnvio == 1 ? 'S√≠' : 'No'}" />
                </p:column>

                <!-- üî¢ C√≥digo Operaci√≥n -->
                <p:column headerText="C√≥digo Operaci√≥n">
                    <h:outputText value="#{operacion.codigoOperacion}" />
                </p:column>

            </p:dataTable>

        </h:form>

        <!-- üí¨ Modal para crear/modificar operaci√≥n -->
        <p:dialog header="Operaci√≥n" widgetVar="dlgOperacion" modal="true"
            resizable="false" closable="true" width="550">
            <h:form id="formDialogOperacion">
                <p:panelGrid columns="2" columnClasses="label,value">

                    <p:outputLabel for="idOperacion" value="ID Operaci√≥n:" />
                    <p:inputText id="idOperacion"
                        value="#{operacionController.operacionModel.operacionEdicion.idOperacion}"
                        readonly="#{operacionController.operacionModel.modificacionOperacion}"
                        required="true" converter="javax.faces.Long" />

                    <p:outputLabel for="idEntidad" value="ID Entidad:" />
                    <p:selectOneMenu id="idEntidad"
                        value="#{operacionController.operacionModel.operacionEdicion.idEntidad}"
                        required="true">
                        <f:selectItem itemLabel="Seleccione una Entidad" itemValue="" noSelectionOption="true" />
                        <f:selectItems value="#{operacionController.operacionModel.listaEntidades}"
                            var="ent" itemLabel="#{ent.descripcion} (#{ent.idEntidad})"
                            itemValue="#{ent.idEntidad}" />
                    </p:selectOneMenu>

                    <p:outputLabel for="idConexion" value="ID Conexi√≥n:" />
                    <p:selectOneMenu id="idConexion"
                        value="#{operacionController.operacionModel.operacionEdicion.idConexion}"
                        required="true" converter="javax.faces.Long">
                        <f:selectItem itemLabel="Seleccione una Conexi√≥n" itemValue="" noSelectionOption="true" />
                        <f:selectItems value="#{operacionController.operacionModel.listaConexiones}"
                            var="con" itemLabel="#{con.host}:#{con.puerto} (#{con.idConexion})"
                            itemValue="#{con.idConexion}" />
                    </p:selectOneMenu>

                    <p:outputLabel for="descripcion" value="Descripci√≥n:" />
                    <p:inputText id="descripcion"
                        value="#{operacionController.operacionModel.operacionEdicion.descripcion}"
                        required="true" />

                    <p:outputLabel for="requiereBodyEnvio" value="Requiere Body Env√≠o:" />
                    <p:selectOneMenu id="requiereBodyEnvio"
                        value="#{operacionController.operacionModel.operacionEdicion.requiereBodyEnvio}"
                        required="true" converter="javax.faces.Integer">
                        <f:selectItem itemLabel="Seleccione" itemValue="" noSelectionOption="true" />
                        <f:selectItem itemLabel="S√≠" itemValue="1" />
                        <f:selectItem itemLabel="No" itemValue="0" />
                    </p:selectOneMenu>

                    <p:outputLabel for="codigoOperacion" value="C√≥digo Operaci√≥n:" />
                    <p:inputText id="codigoOperacion"
                        value="#{operacionController.operacionModel.operacionEdicion.codigoOperacion}"
                        required="true" maxlength="4" />

                </p:panelGrid>

                <p:commandButton value="Guardar" icon="fa fa-save"
                    actionListener="#{operacionController.registrarOperacion()}"
                    update=":formOperaciones:tablaOperaciones, :formOperaciones:messages"
                    oncomplete="if (!args.validationFailed) PF('dlgOperacion').hide();" />
            </h:form>
        </p:dialog>

    </ui:define>

</ui:composition>
